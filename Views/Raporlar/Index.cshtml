@model FanucRelease.ViewModels.RaporlarIndexVM
@{
    ViewData["Title"] = "Raporlar";
}

@section Head {
    <link rel="stylesheet" href="~/css/performance.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/dashboard.css" asp-append-version="true" />
}

<div class="container-fluid">
    <!-- Header + Filters -->
    <div class="d-flex align-items-center justify-content-between mb-4">
        <h2 class="mb-0 text-white" style="text-shadow: 0 2px 8px rgba(0,0,0,.25)">Raporlar</h2>
        <form method="get" class="d-flex align-items-end gap-2">
            <div>
                <label class="form-label text-white-50">Başlangıç</label>
                <input type="date" name="startDate" value="@Model.StartDate?.ToString("yyyy-MM-dd")" class="form-control form-control-sm" />
            </div>
            <div>
                <label class="form-label text-white-50">Bitiş</label>
                <input type="date" name="endDate" value="@Model.EndDate?.ToString("yyyy-MM-dd")" class="form-control form-control-sm" />
            </div>
            <div>
                <label class="form-label text-white-50">Operatör Id</label>
                <input type="number" name="operatorId" value="@(Model.OperatorId?.ToString() ?? "")" class="form-control form-control-sm" placeholder="Opsiyonel" />
            </div>
            <div class="d-flex gap-2 align-items-end">
                <button type="submit" class="btn btn-outline-light btn-sm"><i class="fas fa-filter me-1"></i> Filtrele</button>
                <a class="btn btn-outline-light btn-sm" asp-action="Index"><i class="fas fa-undo me-1"></i> Sıfırla</a>
            </div>
        </form>
    </div>

    <!-- Summary Cards -->
    <div class="row g-3 mb-3">
        <div class="col-md-3">
            <div class="gold-card p-3 text-white bg-gradient-warning">
                <div class="small text-white-50">Toplam Program</div>
                <div class="fs-3 fw-semibold">@Model.ToplamProgram</div>
                <div class="small">Önceki: @Model.OncekiToplamProgram • Delta: @Model.DeltaProgram</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="gold-card p-3 text-white bg-gradient-success">
                <div class="small text-white-50">Toplam Kaynak</div>
                <div class="fs-3 fw-semibold">@Model.ToplamKaynak</div>
                <div class="small">Önceki: @Model.OncekiToplamKaynak • Delta: @Model.DeltaKaynak</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="gold-card p-3 text-white bg-gradient-info">
                <div class="small text-white-50">Başarı Oranı</div>
                <div class="fs-3 fw-semibold">@Model.BasariYuzdesi%</div>
                <div class="small">Önceki: @Model.OncekiBasariYuzdesi% • Delta: @Model.DeltaBasariYuzdesi%</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="gold-card p-3 text-white bg-gradient-danger">
                <div class="small text-white-50">Toplam Hata</div>
                <div class="fs-3 fw-semibold">@Model.ToplamHata</div>
                <div class="small">Önceki: @Model.OncekiToplamHata • Delta: @Model.DeltaHata</div>
            </div>
        </div>
    </div>

    <!-- Content Rows -->
    <div class="row g-3">
        <!-- Top Operators -->
        <div class="col-lg-6">
            <div class="gold-card p-3">
                <div class="section-card-title">En İyi Operatörler</div>
                <div class="mt-2">
                    @if (!Model.TopOperatorlar.Any())
                    {
                        <div class="alert alert-warning mb-0">Kayıt bulunamadı.</div>
                    }
                    else
                    {
                        <div class="list-group">
                            @foreach (var op in Model.TopOperatorlar)
                            {
                                <div class="list-group-item d-flex justify-content-between align-items-center ranking-item">
                                    <div class="d-flex align-items-center gap-2 ranking-item-content">
                                        <div class="avatar-initials avatar-sm brand-gradient-bg text-white">@op.AdSoyad.FirstOrDefault().ToString().ToUpper()</div>
                                        <div>
                                            <div class="fw-semibold">@op.AdSoyad</div>
                                            <div class="small text-muted">@op.ProgramSayisi program • @op.ToplamKaynak kaynak • @op.BasariYuzdesi% başarı</div>
                                        </div>
                                    </div>
                                    <span class="badge badge-pill-gold">@op.HataSayisi hata</span>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Top Programs -->
        <div class="col-lg-6">
            <div class="gold-card p-3">
                <div class="section-card-title">En Yoğun Programlar</div>
                <div class="table-responsive mt-2">
                    <table class="table table-sm table-hover align-middle" id="tbl-rapor-program">
                        <thead>
                            <tr>
                                <th>Program</th>
                                <th>Operatör</th>
                                <th class="text-end">Kaynak</th>
                                <th class="text-end">Başarı</th>
                                <th>Tarih</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var p in Model.TopProgramlar)
                        {
                            <tr>
                                <td>@p.ProgramAdi</td>
                                <td>@p.OperatorAdSoyad</td>
                                <td class="text-end"><span class="@p.BadgeClass">@p.KaynakSayisi</span></td>
                                <td class="text-end">@p.BasariYuzde%</td>
                                <td>@p.TarihText</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Error Trend Placeholder -->
        <div class="col-12">
            <div class="gold-card p-3">
                <div class="section-card-title">Hata Trendi</div>
                @if (Model.HataTrend.Count == 0)
                {
                    <div class="alert alert-info mb-0">Grafik için veri bulunamadı.</div>
                }
                else
                {
                    <div class="table-responsive mt-2">
                        <table class="table table-sm align-middle">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>Hata Sayısı</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var (date, count) in Model.HataTrend)
                                {
                                    <tr>
                                        <td>@date.ToString("dd.MM.yyyy")</td>
                                        <td>@count</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
            </div>
        </div>

        <!-- Longest Programs -->
        <div class="col-12">
            <div class="gold-card p-3">
                <div class="section-card-title">En Uzun Süren Programlar</div>
                <div class="table-responsive mt-2">
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Program</th>
                                <th>Operatör</th>
                                <th class="text-end">Kaynak</th>
                                <th class="text-end">Başarı</th>
                                <th class="text-end">Süre</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var r in Model.UzunSurenProgramlar)
                            {
                                <tr>
                                    <td>@r.ProgramAdi</td>
                                    <td>@(r.OperatorAdSoyad ?? "—")</td>
                                    <td class="text-end">@r.KaynakSayisi</td>
                                    <td class="text-end">@r.BasariYuzdesi%</td>
                                    <td class="text-end">@r.SureText</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Downtime Placeholder -->
        <div class="col-12">
            <div class="gold-card p-3">
                <div class="section-card-title">Duruş Özeti</div>
                <div class="d-flex gap-3">
                    <div><span class="badge badge-pill-gold">@Model.ToplamDurusAdet</span> duruş</div>
                    <div><span class="badge badge-pill-gold">@Model.ToplamDurusSuresi</span> toplam süre</div>
                </div>
                <div class="small text-muted mt-2">Detaylı duruş raporları için altyapı hazırlanıyor.</div>
            </div>
        </div>

        <!-- Daily Trend -->
        <div class="col-12">
            <div class="gold-card p-3">
                <div class="section-card-title">Günlük Trend</div>
                <div class="table-responsive mt-2">
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Tarih</th>
                                <th class="text-end">Program</th>
                                <th class="text-end">Kaynak</th>
                                <th class="text-end">Başarı</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var d in Model.GunlukTrend)
                            {
                                <tr>
                                    <td>@d.Date.ToString("dd.MM.yyyy")</td>
                                    <td class="text-end">@d.Program</td>
                                    <td class="text-end">@d.Kaynak</td>
                                    <td class="text-end">@d.BasariYuzdesi%</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Top Errors -->
        <div class="col-12">
            <div class="gold-card p-3">
                <div class="section-card-title">En Sık Hatalar</div>
                <div class="table-responsive mt-2">
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Kod</th>
                                <th>Açıklama</th>
                                <th class="text-end">Adet</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var h in Model.TopHatalar)
                            {
                                <tr>
                                    <td>@h.Kod</td>
                                    <td>@h.Aciklama</td>
                                    <td class="text-end">@h.Adet</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
